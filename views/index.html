<!DOCTYPE html>
<htmllang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<link rel="stylesheet" type="text/css" href="http://localhost:8080/home/style.css">
<script src ="http://code.jquery.com/jquery-3.3.1.min.js"></script>
<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700" rel="stylesheet">
<title>Demo for GAN Inpainting Project</title>
</head>

<body>

<header>
    <div class="intro">
    <h1>GAN Inpainting with Contextural Attention</h1>
    <h2>Demo for Computational Intelligence &amp; Machine Learning</h2>
    </div>

</header>

<div class="wrapper">
    <section class="about">
    <div class="about-content">
    <br>
    <br>
    <hr>
        <h3>Interactive GAN Inpainting</h3>
        <p> The results are generated by running tests on pretrained models <mark>without any application of post-processing techniques</mark>.<br><br>
        For training, <mark>images of resolution 256 X 256</mark> were used with <mark>largest hole size of 128 X 128</mark>. Therefore, the masking interactive tool provided purposely limits the largest hole size to 128 X 128, above this the result quality will deteriorate. However, <mark>the tool allows you to interactively paint multiple masks</mark>, a feature which can be used to increase rectangular selection beyond the recommended dimensions.
        <br><br>
        <b>Please note:</b> The pretrained models and test files are provided by the orignal author on his <a href="https://github.com/JiahuiYu/generative_inpainting">github</a>. All credits go to him for the source code for the model. I have only implemented an interactive webpage to run tests on models for educational and research purposes. The code for demo with both client-side and server-side scripts with step by step instructions to implement it is provided <a href="https://github.com/mishtynegi/Interactive-tool-for-GAN-Inpainting">here</a>.<br><br>
        <h2>Happy experimenting!!!</h2>
    </div>
    </section>
</div>
<div class="wrapper">
    <section class="about">
    <div class="about-content">
    <br>
    <br>
    <hr>
        <h3>Inpainting using pretrained model on ImageNet</h3>
        <p> ImageNet is a dataset that contains over 10 million natural images of diverse nature. Therefore, the model trained on ImageNet is the <b>most versatile</b> out of the four pretrained models and <b>output generated is qualitatively satisfactory for landscapes, textures and non-facial features.</b><br><br>
       
    </section>
</div>
<!-- Demo 1 (ImageNet Dataset)-->
<section class="xop-section">
    <div class="xop-wrapper">
        <div class="xop-container">
            <div class="xop-actionBox">
                <h4 class="xop-heading">Choose your Canvas</h4>
                <img id="raw1" src="http://localhost:8080/static/image1.jpg" alt="Input for the masking" width="256px" height="256px">
                <button class="xop-btn" onclick="changePictureOnDemo1()"">Randomize<i aria-hidden="true" class="fa fa-download"></i></button>
            </div>
            <div class="xop-actionBox">
                <h4 class="xop-heading">Start Drawing</h4>
                <canvas id="inputCanvas1" width="256" height="256">
                <img id="input1" src="http://localhost:8080/static/image1.jpg" alt="Input for the masking" width="256px" height="256px">
                </canvas>
                <button class="xop-btn" onclick="resetMasksOnDemo1()">Undo<i aria-hidden="true" class="fa fa-upload"></i></button>
            </div>
            <div class="xop-actionBox">
                <h4 class="xop-heading">Your Creation</h4>
                <canvas id="outputCanvas1" width="256" height="256">
                <img id="output1" src="transparent.png" width="256px" height="256px">
                </canvas>
                <button id="paintbtn1" class="xop-btn">Paint<i aria-hidden="true" class="fa fa-share-alt"></i></button>
            </div>
        </div>
    </div>
</section>
<div class="wrapper">
    <section class="about">
    <div class="about-content">
        <h3>Behind the Scenes</h3> 
    </section>
</div>
<section class="xop-sectionD">
    <div class="xop-wrapperD">
        <div class="xop-containerD">
            <div class="xop-actionBoxD">
                <h4 class="xop-headingD">Input 1 <br>Image to Inpaint</h4>
                <img src="http://localhost:8080/static/input_forDemo.png" alt="Input for demo" width="256px" height="256px">
                <p>The image to be inpainted is selected using randomise function. The interactive masking tool is used to select portions to mask.</p>
            </div>
            <div class="xop-actionBoxD">
                <h4 class="xop-headingD">Input 2 <br> Mask file</h4>
                <img src="http://localhost:8080/static/mask_forDemo.png" alt="Input for the masking" width="256px" height="256px">
                <p>A file with masks is simultaneoulsy prepared while the rectangular selections are being made by the user on the pictue to be inpainted.
            </div>
            <div class="xop-actionBoxD">
                <h4 class="xop-headingD">Output <br> Inpainted Image</h4>
                <img src="http://localhost:8080/static/output_forDemo.png" alt="Output for Inpainted Result"" width="256px" height="256px">
                <p>Input 1 and Input 2 are passsed as parameters to test.py that generates the inpainted result.</p>
            </div>
        </div>
    </div>
</section>

<!-- Demo 4 (Places2 Dataset) -->
<div class="wrapper">
    <section class="about">
    <div class="about-content">
    <br>
    <br>
    <hr>
   <h3>Inpainting using pretrained model on Places2</h3>
    <p>The Places2 dataset consists of over 10 million natural images used for <b>scene recognition</b>. The inpainting
    results are <b>qualitatively satisfactory for scene and object completion.</b></p>
    </section> 
</div>
<section class="xop-section">
    <div class="xop-wrapper">
        <div class="xop-container">
            <div class="xop-actionBox">
                <h4 class="xop-heading">Choose your Canvas</h4>
                <img id="raw4" src="http://localhost:8080/static/places1.jpg" alt="Input for the masking" width="256px" height="256px">
                <button class="xop-btn" onclick="changePictureOnDemo4()"">Randomize<i aria-hidden="true" class="fa fa-download"></i></button>
            </div>
            <div class="xop-actionBox">
                <h4 class="xop-heading">Start Drawing</h4>
                <canvas id="inputCanvas4" width="256" height="256">
                <img id="input4" src="http://localhost:8080/static/places1.jpg" alt="Input for the masking" width="256px" height="256px">
                </canvas>
                <button class="xop-btn" onclick="resetMasksOnDemo4()">Undo<i aria-hidden="true" class="fa fa-upload"></i></button>
            </div>
            <div class="xop-actionBox">
                <h4 class="xop-heading">Your Creation</h4>
                <canvas id="outputCanvas4" width="256" height="256">
                <img id="output4" src="transparent.png" width="256px" height="256px">
                </canvas>
                <button id="paintbtn4" class="xop-btn">Paint<i aria-hidden="true" class="fa fa-share-alt"></i></button>
            </div>
        </div>
    </div>
</section>

<!-- Demo 2 (CelebA Dataset) -->
<div class="wrapper">
    <section class="about">
    <div class="about-content">
    <br>
    <br>
    <hr>
    <h3>Inpainting using pretrained model on CelebA</h3>
    <p>CelebFaces Attributes Dataset (CelebA) comprises of over 200,000 celebrity images with face attributes. The model does not perform well in filling masked facial features of random people. The quality of outputs produced from using pretrained models on CelebA and Celeba-HQ were found to be <b>inferior to the results reported in the original paper.</b></p>
    </section>
</div>

<section class="xop-section">
    <div class="xop-wrapper">
        <div class="xop-container">
            <div class="xop-actionBox">
                <h4 class="xop-heading">Choose your Canvas</h4>
                <img id="raw2" src="http://localhost:8080/static/face1.jpg" alt="Input for the masking" width="256px" height="256px">
                <button class="xop-btn" onclick="changePictureOnDemo2()"">Randomize<i aria-hidden="true" class="fa fa-download"></i></button>
            </div>
            <div class="xop-actionBox">
                <h4 class="xop-heading">Start Drawing</h4>
                <canvas id="inputCanvas2" width="256" height="256">
                <img id="input2" src="http://localhost:8080/static/face1.jpg" alt="Input for the masking" width="256px" height="256px">
                </canvas>
                <button class="xop-btn" onclick="resetMasksOnDemo2()">Undo<i aria-hidden="true" class="fa fa-upload"></i></button>
            </div>
            <div class="xop-actionBox">
                <h4 class="xop-heading">Your Creation</h4>
                <canvas id="outputCanvas2" width="256" height="256">
                <img id="output2" src="transparent.png" width="256px" height="256px">
                </canvas>
                <button id="paintbtn2" class="xop-btn">Paint<i aria-hidden="true" class="fa fa-share-alt"></i></button>
            </div>
        </div>
    </div>
</section>

<!-- Demo 5 (DTD Dataset self-trained) -->
<div class="wrapper">
    <section class="about">
    <div class="about-content">
    <br>
    <br>
    <hr>
   <h3>Inpainting using model trained by us on DTD</h3>
    <p>Describable Textures Dataset (DTD) consists of textural images that are organised in 47 categories. The data was split into three equal parts with approximately 40 images per category in each of the train, validation and test sets.<b> The inpainting
    results are <b>able to capture textures that are rich in variety and structure</b>.</p>
    </section> 
</div>
<section class="xop-section">
    <div class="xop-wrapper">
        <div class="xop-container">
            <div class="xop-actionBox">
                <h4 class="xop-heading">Choose your Canvas</h4>
                <img id="raw5" src="http://localhost:8080/static/dtd1.jpg" alt="Input for the masking" width="256px" height="256px">
                <button class="xop-btn" onclick="changePictureOnDemo5()"">Randomize<i aria-hidden="true" class="fa fa-download"></i></button>
            </div>
            <div class="xop-actionBox">
                <h4 class="xop-heading">Start Drawing</h4>
                <canvas id="inputCanvas5" width="256" height="256">
                <img id="input5" src="http://localhost:8080/static/dtd1.jpg" alt="Input for the masking" width="256px" height="256px">
                </canvas>
                <button class="xop-btn" onclick="resetMasksOnDemo5()">Undo<i aria-hidden="true" class="fa fa-upload"></i></button>
            </div>
            <div class="xop-actionBox">
                <h4 class="xop-heading">Your Creation</h4>
                <canvas id="outputCanvas5" width="256" height="256">
                <img id="output5" src="transparent.png" width="256px" height="256px">
                </canvas>
                <button id="paintbtn5" class="xop-btn">Paint<i aria-hidden="true" class="fa fa-share-alt"></i></button>
            </div>
        </div>
    </div>
</section>

<!-- Demo 3 Contextual Attention Layer Style Transfer -->
<div class="wrapper">
    <section class="about">
    <div class="about-content">
    <br>
    <br>
    <hr>
    <h3>Style Transfer using Contextual Attention Layer</h3>
    <p>The paper proposes a novel contextual attention layer to improve the coarse results from the baseline model by <b>borrowing similar features from the background and applying it into the foreground image to reconstruct missing patches.</b> Here we implement a special case of contextual attention layer by applying it on RGB feature space, using background to construct foreground. 
 </p>
    </section>
</div>

<section class="xop-section">
    <div class="xop-wrapper">
        <div class="xop-container">
            <div class="xop-actionBox">
                <h4 class="xop-heading">Start Drawing</h4>
                <canvas id="inputCanvas31" width="256" height="256">
                <img id="input31" src="http://localhost:8080/static/image1.jpg" alt="Input 1" width="256px" height="256px">
                </canvas>
                <button class="xop-btn" onclick="changePictureOnDemo31()"">Randomize<i aria-hidden="true" class="fa fa-download"></i></button>
            </div>
            <div class="xop-actionBox">
                <h4 class="xop-heading">Start Drawing</h4>
                <canvas id="inputCanvas32" width="256" height="256">
                <img id="input32" src="http://localhost:8080/static/style1.jpg" alt="Input 2" width="256px" height="256px">
                </canvas>
                <button class="xop-btn" onclick="changePictureOnDemo32()">Randomize<i aria-hidden="true" class="fa fa-upload"></i></button>
            </div>
            <div class="xop-actionBox">
                <h4 class="xop-heading">Your Creation</h4>
                <canvas id="outputCanvas3" width="256" height="256">
                <img id="output3" src="transparent.png" width="256px" height="256px">
                </canvas>
                <button id="mergebtn3" class="xop-btn">Merge<i aria-hidden="true" class="fa fa-share-alt"></i></button>
            </div>
        </div>
    </div>
</section>

<div class="xop-actionBox-Mask">
<canvas id="maskCanvas1" width="256" height="256" visibility: hidden></canvas>
<canvas id="maskCanvas2" width="256" height="256" visibility: hidden></canvas>
<canvas id="maskCanvas4" width="256" height="256" visibility: hidden></canvas>
<canvas id="maskCanvas5" width="256" height="256" visibility: hidden></canvas>

<script>
window.onload = function() {
  // for Demo1 (ImageNet)
  var inputCanvas1 = document.getElementById("inputCanvas1");
  var inputCtx1 = inputCanvas1.getContext("2d");
  var inputImg1 = new Image();
  inputImg1.src = document.getElementById("input1").src;
  inputImg1.crossOrigin = "Anonymous";
  inputCtx1.drawImage(inputImg1, 0, 0, 256, 256);
  var maskCanvas1 = document.getElementById("maskCanvas1");
  var maskCtx1 = maskCanvas1.getContext("2d");
  maskCtx1.fillStyle = "#000000";
  maskCtx1.fillRect(0, 0, 256, 256);
  var outputCanvas1 = document.getElementById("outputCanvas1");
  var outputCtx1 = outputCanvas1.getContext("2d");

    //for Demo2 (CelebA)
  var inputCanvas2 = document.getElementById("inputCanvas2");
  var inputCtx2 = inputCanvas2.getContext("2d");
  var inputImg2 = new Image();
  inputImg2.src = document.getElementById("input2").src;
  inputImg2.crossOrigin = "Anonymous";
  inputCtx2.drawImage(inputImg2, 0, 0, 256, 256);
  var maskCanvas2 = document.getElementById("maskCanvas2");
  var maskCtx2 = maskCanvas2.getContext("2d");
  maskCtx2.fillStyle = "#000000";
  maskCtx2.fillRect(0, 0, 256, 256);
  var outputCanvas2 = document.getElementById("outputCanvas2");
  var outputCtx2 = outputCanvas1.getContext("2d");

    //for Demo3 (Contextual Attention Layer)
  var inputCanvas31 = document.getElementById("inputCanvas31");
  var inputCtx31 = inputCanvas31.getContext("2d");
  var inputImg31 = new Image();
  inputImg31.src = document.getElementById("input31").src;
  inputImg31.crossOrigin = "Anonymous";
  inputCtx31.drawImage(inputImg31, 0, 0, 256, 256);

  var inputCanvas32 = document.getElementById("inputCanvas32");
  var inputCtx32 = inputCanvas32.getContext("2d");
  var inputImg32 = new Image();
  inputImg32.src = document.getElementById("input32").src;
  inputImg32.crossOrigin = "Anonymous";
  inputCtx32.drawImage(inputImg32, 0, 0, 256, 256);

      //for Demo4 (Places2)
  var inputCanvas4 = document.getElementById("inputCanvas4");
  var inputCtx4 = inputCanvas4.getContext("2d");
  var inputImg4 = new Image();
  inputImg4.src = document.getElementById("input4").src;
  inputImg4.crossOrigin = "Anonymous";
  inputCtx4.drawImage(inputImg4, 0, 0, 256, 256);
  var maskCanvas4 = document.getElementById("maskCanvas4");
  var maskCtx4 = maskCanvas4.getContext("2d");
  maskCtx4.fillStyle = "#000000";
  maskCtx4.fillRect(0, 0, 256, 256);
  var outputCanvas4 = document.getElementById("outputCanvas4");
  var outputCtx4 = outputCanvas4.getContext("2d");

        //for Demo5 (DTD)
  var inputCanvas5 = document.getElementById("inputCanvas5");
  var inputCtx5 = inputCanvas5.getContext("2d");
  var inputImg5 = new Image();
  inputImg5.src = document.getElementById("input5").src;
  inputImg5.crossOrigin = "Anonymous";
  inputCtx5.drawImage(inputImg5, 0, 0, 256, 256);
  var maskCanvas5 = document.getElementById("maskCanvas5");
  var maskCtx5 = maskCanvas5.getContext("2d");
  maskCtx5.fillStyle = "#000000";
  maskCtx5.fillRect(0, 0, 256, 256);
  var outputCanvas5 = document.getElementById("outputCanvas5");
  var outputCtx5 = outputCanvas5.getContext("2d");

}
</script>

<div class="wrapper">
    <section class="about">
    <div class="about-content">
    <br>
    <br>
    <hr>
    <h3>References</h3>
    <p><ul style="list-style-type:circle;">
        <li>Code for training and testing models: <a href="https://github.com/JiahuiYu/generative_inpainting">https://github.com/JiahuiYu/generative_inpainting</a></li><br>
        <li>Pretrained models on ImageNet, Places2 and CelebA: <a href="https://github.com/JiahuiYu/generative_inpainting">https://github.com/JiahuiYu/generative_inpainting</a></li><br>
        <li>Insipiration for flexibox:<a href="https://github.com/JiahuiYu/generative_inpainting"> https://www.youtube.com/watch?v=Bb9Zygnzy1g</a></li></br>
        <li>Credit for the cat picture to fotostok_pdv on Thinkstock by Getty Images: <a href="http://www.thinkstockphotos.co.uk/image/stock-photo-portrait-of-maine-coon-cat/621586428"> Potrait of maine coon cat</a></li><br>
        <li>All other images used for the purpose of the demonstration were found using advanced search on google images with usage rights set to 'free to use, share or modify'.</li>
        </ul></p>
    </section>
</div>
<br><br><br><br>
<footer>
    <div class="footer-content">
        <p class="credit">&copy; Copyright 2019 Mishty Negi<br>
        Interactive tool designed and developed for educational and research purposes only</p>
        <ul class="social">
            <li><a href="https://github.com/mishtynegi/Interactive-tool-for-GAN-Inpainting"" target="_blank">Github</a></li>
        </ul>
    </div>
</footer>
<script>
$.support.cors = true;
$("#paintbtn1").click(function() {
    console.log("Success");
    var mask = document.getElementById("maskCanvas1");
    var maskUrl = mask.toDataURL("image/png").replace(/^data:image\/(png|jpg);base64,/, "");
    var input = document.getElementById("inputCanvas1");
    var inputUrl = input.toDataURL("image/png").replace(/^data:image\/(png|jpg);base64,/, "");

    $.post({
        url: "http://localhost:8080/inpaint",
        dataType : 'text',
        contentType: 'application/json',
        data: JSON.stringify({"mask" : maskUrl, "input" : inputUrl, "model" : "release_imagenet_256"}),
        success: function(data) {
            var canvas = document.getElementById("outputCanvas1");
            var ctx = canvas.getContext("2d");
            var img = new Image();
            img.crossOrigin = "Anonymous";
            img.onload = function(){
              ctx.drawImage(img, 0, 0, 256, 256);
            };
            img.src = 'data:image/png;base64,'+data;
        },
        error: function(jqXHR, exception) {
            console.log(jqXHR);
        }

    })
});

$("#paintbtn2").click(function() {
    console.log("Success");
    var mask = document.getElementById("maskCanvas2");
    var maskUrl = mask.toDataURL("image/png").replace(/^data:image\/(png|jpg);base64,/, "");
    var input = document.getElementById("inputCanvas2");
    var inputUrl = input.toDataURL("image/png").replace(/^data:image\/(png|jpg);base64,/, "");

    $.post({
        url: "http://localhost:8080/inpaint",
        dataType : 'text',
        contentType: 'application/json',
        data: JSON.stringify({"mask" : maskUrl, "input" : inputUrl, "model" : "release_celeba_256"}),
        success: function(data) {
            var canvas = document.getElementById("outputCanvas2");
            var ctx = canvas.getContext("2d");
            var img = new Image();
            img.crossOrigin = "Anonymous";
            img.onload = function(){
              ctx.drawImage(img, 0, 0, 256, 256);
            };
            img.src = 'data:image/png;base64,'+data;
        },
        error: function(jqXHR, exception) {
            console.log(jqXHR);
        }

    })
});

$("#mergebtn3").click(function() {
    console.log("Success");
    var inputA = document.getElementById("inputCanvas31");
    var inputAUrl = inputA.toDataURL("image/png").replace(/^data:image\/(png|jpg);base64,/, "");
    var inputB = document.getElementById("inputCanvas32");
    var inputBUrl = inputB.toDataURL("image/png").replace(/^data:image\/(png|jpg);base64,/, "");

    $.post({
        url: "http://localhost:8080/styleTransfer",
        dataType : 'text',
        contentType: 'application/json',
        data: JSON.stringify({"inputA" : inputBUrl, "inputB" : inputAUrl}),
        success: function(data) {
            var canvas = document.getElementById("outputCanvas3");
            var ctx = canvas.getContext("2d");
            // var img = document.getElementById("output1");
            var img = new Image();
            img.crossOrigin = "Anonymous";
            img.onload = function(){
              ctx.drawImage(img, 0, 0, 256, 256);
            };
            img.src = 'data:image/png;base64,'+data;
        },
        error: function(jqXHR, exception) {
            console.log(jqXHR);
        }

    })
});

$("#paintbtn4").click(function() {
    console.log("Success");
    var mask = document.getElementById("maskCanvas4");
    var maskUrl = mask.toDataURL("image/png").replace(/^data:image\/(png|jpg);base64,/, "");
    var input = document.getElementById("inputCanvas4");
    var inputUrl = input.toDataURL("image/png").replace(/^data:image\/(png|jpg);base64,/, "");

    $.post({
        url: "http://localhost:8080/inpaint",
        dataType : 'text',
        contentType: 'application/json',
        data: JSON.stringify({"mask" : maskUrl, "input" : inputUrl, "model" : "release_places2_256"}),
        success: function(data) {
            var canvas = document.getElementById("outputCanvas4");
            var ctx = canvas.getContext("2d");
            // var img = document.getElementById("output1");
            var img = new Image();
            img.crossOrigin = "Anonymous";
            img.onload = function(){
              ctx.drawImage(img, 0, 0, 256, 256);
            };
            img.src = 'data:image/png;base64,'+data;
        },
        error: function(jqXHR, exception) {
            console.log(jqXHR);
        }

    })
});

$("#paintbtn5").click(function() {
    console.log("Success");
    var mask = document.getElementById("maskCanvas5");
    var maskUrl = mask.toDataURL("image/png").replace(/^data:image\/(png|jpg);base64,/, "");
    var input = document.getElementById("inputCanvas5");
    var inputUrl = input.toDataURL("image/png").replace(/^data:image\/(png|jpg);base64,/, "");

    $.post({
        url: "http://localhost:8080/inpaint",
        dataType : 'text',
        contentType: 'application/json',
        data: JSON.stringify({"mask" : maskUrl, "input" : inputUrl, "model" : "release_dtd_256"}),
        success: function(data) {
            var canvas = document.getElementById("outputCanvas5");
            var ctx = canvas.getContext("2d");
            // var img = document.getElementById("output1");
            var img = new Image();
            img.crossOrigin = "Anonymous";
            img.onload = function(){
              ctx.drawImage(img, 0, 0, 256, 256);
            };
            img.src = 'data:image/png;base64,'+data;
        },
        error: function(jqXHR, exception) {
            console.log(jqXHR);
        }

    })
});

function changePictureOnDemo1(){
    var yourImages = ["image1.jpg","image2.jpg","image3.jpg", "image4.jpg", "image5.jpg", "image6.jpg","image7.jpg","image8.jpg", "image9.jpg", "style2.jpg", "style5.jpg", "style9.jpg"];
    var randomImage = Math.floor(Math.random()*yourImages.length);
    var server = "http://localhost:8080/static/";
    document.getElementById("raw1").src=server + yourImages[randomImage];
    document.getElementById("input1").src=server + yourImages[randomImage];
    document.getElementById("output1").src="transparent.png";
    var ctx = inputCanvas1.getContext("2d");
    var img = new Image();
    img.crossOrigin = "Anonymous";
    img.onload = function(){
      ctx.drawImage(img, 0, 0, 256, 256);
    };
    img.src = document.getElementById("input1").src;
    var maskCanvas = document.getElementById("maskCanvas1");
    maskCtx = maskCanvas.getContext("2d");
    maskCtx.clearRect(0, 0, 256, 256);
    maskCtx.fillStyle="#000000";
    maskCtx.fillRect(0, 0, 256, 256);

    var canvas2 = document.getElementById("outputCanvas1");
    var ctx2 = canvas2.getContext("2d");
    ctx2.clearRect(0, 0, 256, 256);
    var img2 = document.getElementById("output1");
    ctx2.drawImage(img2, 0, 0, 256, 256);
  }

function resetMasksOnDemo1(){
    var canvas = document.getElementById("inputCanvas1");
    var ctx = canvas.getContext("2d");
    var img = new Image();
    img.crossOrigin = "Anonymous";
    img.src = document.getElementById("input1").src;
    ctx.drawImage(img, 0, 0, 256, 256);
    var maskCanvas = document.getElementById("maskCanvas1");
    maskCtx = maskCanvas.getContext('2d');
    maskCtx.clearRect(0, 0, 256, 256);
    maskCtx.fillStyle="#000000";
    maskCtx.fillRect(0, 0, 256, 256);
}

function changePictureOnDemo2(){
    var yourImages = ["face1.jpg","face2.jpg","face3.jpg", "face4.jpg", "face5.jpg", "face6.jpg"];
    var randomImage = Math.floor(Math.random()*yourImages.length);
    var server = "http://localhost:8080/static/";
    document.getElementById("raw2").src=server + yourImages[randomImage];
    document.getElementById("input2").src=server + yourImages[randomImage];
    document.getElementById("output2").src="transparent.png";
    var ctx = inputCanvas2.getContext("2d");
    var img = new Image();
    img.crossOrigin = "Anonymous";
    img.onload = function(){
      ctx.drawImage(img, 0, 0, 256, 256);
    };
    img.src = document.getElementById("input2").src;
    var maskCanvas = document.getElementById("maskCanvas2");
    maskCtx = maskCanvas.getContext("2d");
    maskCtx.clearRect(0, 0, 256, 256);
    maskCtx.fillStyle="#000000";
    maskCtx.fillRect(0, 0, 256, 256);

    var canvas2 = document.getElementById("outputCanvas2");
    var ctx2 = canvas2.getContext("2d");
    ctx2.clearRect(0, 0, 256, 256);
    var img2 = document.getElementById("output2");
    ctx2.drawImage(img2, 0, 0, 256, 256);
  }

  function resetMasksOnDemo2(){
    var canvas = document.getElementById("inputCanvas2");
    var ctx = canvas.getContext("2d");
    var img = new Image();
    img.crossOrigin = "Anonymous";
    img.src = document.getElementById("input2").src;
    ctx.drawImage(img, 0, 0, 256, 256);
    var maskCanvas = document.getElementById("maskCanvas2");
    maskCtx = maskCanvas.getContext('2d');
    maskCtx.clearRect(0, 0, 256, 256);
    maskCtx.fillStyle="#000000";
    maskCtx.fillRect(0, 0, 256, 256);
}

function changePictureOnDemo31(){
    var yourImages = ["image1.jpg","image3.jpg","image4.jpg", "face1.jpg", "image7.jpg", "image10.jpg"];
    var randomImage = Math.floor(Math.random()*yourImages.length);
    var server = "http://localhost:8080/static/";
    document.getElementById("input31").src=server + yourImages[randomImage];
    document.getElementById("output3").src="transparent.png";
    var ctx = inputCanvas31.getContext("2d");
    var img = new Image();
    img.crossOrigin = "Anonymous";
    img.onload = function(){
      ctx.drawImage(img, 0, 0, 256, 256);
    };
    img.src = document.getElementById("input31").src;
  }

  function changePictureOnDemo32(){
    var yourImages = ["style1.jpg","style2.jpg","style3.jpg", "style4.jpg", "style5.jpg", "style6.jpg","style7.jpg", "style8.jpg", "style9.jpg"];
    var randomImage = Math.floor(Math.random()*yourImages.length);
    var server = "http://localhost:8080/static/";
    document.getElementById("input32").src=server + yourImages[randomImage];
    document.getElementById("output3").src="transparent.png";
    var ctx = inputCanvas32.getContext("2d");
    var img = new Image();
    img.crossOrigin = "Anonymous";
    img.onload = function(){
      ctx.drawImage(img, 0, 0, 256, 256);
    };
    img.src = document.getElementById("input32").src;
  }

  function changePictureOnDemo4(){
    var yourImages = ["places1.jpg","places2.jpg","places3.jpg", "places4.jpg", "image2.jpg", "image3.jpg","image6.jpg","image8.jpg"];
    var randomImage = Math.floor(Math.random()*yourImages.length);
    var server = "http://localhost:8080/static/";
    document.getElementById("raw4").src=server + yourImages[randomImage];
    document.getElementById("input4").src=server + yourImages[randomImage];
    document.getElementById("output4").src="transparent.png";
    var ctx = inputCanvas4.getContext("2d");
    var img = new Image();
    img.crossOrigin = "Anonymous";
    img.onload = function(){
      ctx.drawImage(img, 0, 0, 256, 256);
    };
    img.src = document.getElementById("input4").src;
    var maskCanvas = document.getElementById("maskCanvas4");
    maskCtx = maskCanvas.getContext("2d");
    maskCtx.clearRect(0, 0, 256, 256);
    maskCtx.fillStyle="#000000";
    maskCtx.fillRect(0, 0, 256, 256);

    var canvas4 = document.getElementById("outputCanvas4");
    var ctx4 = canvas4.getContext("2d");
    ctx4.clearRect(0, 0, 256, 256);
    var img4 = document.getElementById("output4");
    ctx4.drawImage(img4, 0, 0, 256, 256);
  }

  function resetMasksOnDemo4(){
    var canvas = document.getElementById("inputCanvas4");
    var ctx = canvas.getContext("2d");
    var img = new Image();
    img.crossOrigin = "Anonymous";
    img.src = document.getElementById("input4").src;
    ctx.drawImage(img, 0, 0, 256, 256);
    var maskCanvas = document.getElementById("maskCanvas4");
    maskCtx = maskCanvas.getContext('2d');
    maskCtx.clearRect(0, 0, 256, 256);
    maskCtx.fillStyle="#000000";
    maskCtx.fillRect(0, 0, 256, 256);
}

  function changePictureOnDemo5(){
    var yourImages = ["dtd1.jpg","dtd2.jpg","dtd3.jpg", "dtd4.jpg", "dtd5.jpg", "dtd6.jpg"];
    var randomImage = Math.floor(Math.random()*yourImages.length);
    var server = "http://localhost:8080/static/";
    document.getElementById("raw5").src=server + yourImages[randomImage];
    document.getElementById("input5").src=server + yourImages[randomImage];
    document.getElementById("output5").src="transparent.png";
    var ctx = inputCanvas5.getContext("2d");
    var img = new Image();
    img.crossOrigin = "Anonymous";
    img.onload = function(){
      ctx.drawImage(img, 0, 0, 256, 256);
    };
    img.src = document.getElementById("input5").src;
    var maskCanvas = document.getElementById("maskCanvas5");
    maskCtx = maskCanvas.getContext("2d");
    maskCtx.clearRect(0, 0, 256, 256);
    maskCtx.fillStyle="#000000";
    maskCtx.fillRect(0, 0, 256, 256);

    var canvas5 = document.getElementById("outputCanvas5");
    var ctx5 = canvas5.getContext("2d");
    ctx5.clearRect(0, 0, 256, 256);
    var img5 = document.getElementById("output5");
    ctx5.drawImage(img5, 0, 0, 256, 256);
  }

  function resetMasksOnDemo5(){
    var canvas = document.getElementById("inputCanvas5");
    var ctx = canvas.getContext("2d");
    var img = new Image();
    img.crossOrigin = "Anonymous";
    img.src = document.getElementById("input5").src;
    ctx.drawImage(img, 0, 0, 256, 256);
    var maskCanvas = document.getElementById("maskCanvas5");
    maskCtx = maskCanvas.getContext('2d');
    maskCtx.clearRect(0, 0, 256, 256);
    maskCtx.fillStyle="#000000";
    maskCtx.fillRect(0, 0, 256, 256);
}

var inputCanvas1 = document.getElementById('inputCanvas1'),
    inputCtx1 = inputCanvas1.getContext('2d'),
    rect1 = {},
    imageData1,
    drag1 = false;

var maskCanvas1 = document.getElementById("maskCanvas1"),
    maskCtx1 = maskCanvas1.getContext('2d'),
    rect1 = {},
    drag1 = false;

var inputCanvas2 = document.getElementById('inputCanvas2'),
    inputCtx2 = inputCanvas2.getContext('2d'),
    rect2 = {},
    imageData2,
    drag2 = false;

var maskCanvas2 = document.getElementById("maskCanvas2"),
    maskCtx2 = maskCanvas2.getContext('2d'),
    rect2 = {},
    drag2 = false;

var inputCanvas4 = document.getElementById('inputCanvas4'),
    inputCtx4 = inputCanvas4.getContext('2d'),
    rect4 = {},
    imageData4,
    drag4 = false;

var maskCanvas4 = document.getElementById("maskCanvas4"),
    maskCtx4 = maskCanvas4.getContext('2d'),
    rect4 = {},
    drag4 = false;

var inputCanvas5 = document.getElementById('inputCanvas5'),
    inputCtx5 = inputCanvas5.getContext('2d'),
    rect5 = {},
    imageData5,
    drag5 = false;

var maskCanvas5 = document.getElementById("maskCanvas5"),
    maskCtx5 = maskCanvas5.getContext('2d'),
    rect5 = {},
    drag5 = false;

function init() {
  inputCanvas1.addEventListener('mousedown', mouseDownForDemo1, false);
  inputCanvas1.addEventListener('mouseup', mouseUpForDemo1, false);
  inputCanvas1.addEventListener('mousemove', mouseMoveForDemo1, false);

  inputCanvas2.addEventListener('mousedown', mouseDownForDemo2, false);
  inputCanvas2.addEventListener('mouseup', mouseUpForDemo2, false);
  inputCanvas2.addEventListener('mousemove', mouseMoveForDemo2, false);

  inputCanvas4.addEventListener('mousedown', mouseDownForDemo4, false);
  inputCanvas4.addEventListener('mouseup', mouseUpForDemo4, false);
  inputCanvas4.addEventListener('mousemove', mouseMoveForDemo4, false);

  inputCanvas5.addEventListener('mousedown', mouseDownForDemo5, false);
  inputCanvas5.addEventListener('mouseup', mouseUpForDemo5, false);
  inputCanvas5.addEventListener('mousemove', mouseMoveForDemo5, false);
}

function mouseDownForDemo1(e) {
  imageData1 = inputCtx1.getImageData(0,0, inputCanvas1.width, inputCanvas1.height);
  rect1.startX = e.pageX - this.offsetLeft;
  rect1.startY = e.pageY - this.offsetTop;
  drag1 = true;
}

function mouseDownForDemo2(e) {
  imageData2 = inputCtx2.getImageData(0,0, inputCanvas2.width, inputCanvas2.height);
  rect2.startX = e.pageX - this.offsetLeft;
  rect2.startY = e.pageY - this.offsetTop;
  drag2 = true;
}

function mouseDownForDemo4(e) {
  imageData4 = inputCtx4.getImageData(0,0, inputCanvas4.width, inputCanvas4.height);
  rect4.startX = e.pageX - this.offsetLeft;
  rect4.startY = e.pageY - this.offsetTop;
  drag4 = true;
}

function mouseDownForDemo5(e) {
  imageData5 = inputCtx5.getImageData(0,0, inputCanvas5.width, inputCanvas5.height);
  rect5.startX = e.pageX - this.offsetLeft;
  rect5.startY = e.pageY - this.offsetTop;
  drag5 = true;
}

function mouseUpForDemo1(e){
    drag1=false;
    if(rect1.w <= 128 && rect1.h <= 128){
      fillMaskRectOnMyMaskCanvas(rect1.w, rect1.h, maskCtx1, rect1);
      fillMaskRectOnMyCanvas(rect1.w, rect1.h, inputCtx1, rect1);
    }else{
      if(rect1.w >= 128 && rect1.h >= 128){
        fillMaskRectOnMyMaskCanvas(128, 128, maskCtx1, rect1);
        fillMaskRectOnMyCanvas(128, 128, inputCtx1, rect1);
      }else{
        if(rect1.w >= 128){
          fillMaskRectOnMyMaskCanvas(128, rect1.h, maskCtx1, rect1);
          fillMaskRectOnMyCanvas(128, rect1.h, inputCtx1, rect1);
        }else{
          fillMaskRectOnMyMaskCanvas(rect1.w, 128, maskCtx1, rect1);
          fillMaskRectOnMyCanvas(rect1.w, 128, inputCtx1, rect1);
        }
      }
    }
}

function mouseUpForDemo2(e){
    drag2=false;
    if(rect2.w <= 128 && rect2.h <= 128){
      fillMaskRectOnMyMaskCanvas(rect2.w, rect2.h, maskCtx2, rect2);
      fillMaskRectOnMyCanvas(rect2.w, rect2.h, inputCtx2, rect2);
    }else{
      if(rect2.w >= 128 && rect2.h >= 128){
        fillMaskRectOnMyMaskCanvas(128, 128, maskCtx2, rect2);
        fillMaskRectOnMyCanvas(128, 128, inputCtx2, rect2);
      }else{
        if(rect2.w >= 128){
          fillMaskRectOnMyMaskCanvas(128, rect2.h, maskCtx2, rect2);
          fillMaskRectOnMyCanvas(128, rect2.h, inputCtx2, rect2);
        }else{
          fillMaskRectOnMyMaskCanvas(rect2.w, 128, maskCtx2, rect2);
          fillMaskRectOnMyCanvas(rect2.w, 128, inputCtx2, rect2);
        }
      }
    }
}

function mouseUpForDemo4(e){
    drag4=false;
    if(rect4.w <= 128 && rect4.h <= 128){
      fillMaskRectOnMyMaskCanvas(rect4.w, rect4.h, maskCtx4, rect4);
      fillMaskRectOnMyCanvas(rect4.w, rect4.h, inputCtx4, rect4);
    }else{
      if(rect4.w >= 128 && rect4.h >= 128){
        fillMaskRectOnMyMaskCanvas(128, 128, maskCtx4, rect4);
        fillMaskRectOnMyCanvas(128, 128, inputCtx4, rect4);
      }else{
        if(rect4.w >= 128){
          fillMaskRectOnMyMaskCanvas(128, rect4.h, maskCtx4, rect4);
          fillMaskRectOnMyCanvas(128, rect4.h, inputCtx4, rect4);
        }else{
          fillMaskRectOnMyMaskCanvas(rect4.w, 128, maskCtx4, rect4);
          fillMaskRectOnMyCanvas(rect4.w, 128, inputCtx4, rect4);
        }
      }
    }
}

function mouseUpForDemo5(e){
    drag5=false;
    if(rect5.w <= 128 && rect5.h <= 128){
      fillMaskRectOnMyMaskCanvas(rect5.w, rect5.h, maskCtx5, rect5);
      fillMaskRectOnMyCanvas(rect5.w, rect5.h, inputCtx5, rect5);
    }else{
      if(rect5.w >= 128 && rect5.h >= 128){
        fillMaskRectOnMyMaskCanvas(128, 128, maskCtx5, rect5);
        fillMaskRectOnMyCanvas(128, 128, inputCtx5, rect5);
      }else{
        if(rect5.w >= 128){
          fillMaskRectOnMyMaskCanvas(128, rect5.h, maskCtx5, rect5);
          fillMaskRectOnMyCanvas(128, rect5.h, inputCtx5, rect5);
        }else{
          fillMaskRectOnMyMaskCanvas(rect5.w, 128, maskCtx5, rect5);
          fillMaskRectOnMyCanvas(rect5.w, 128, inputCtx5, rect5);
        }
      }
    }
}

function mouseMoveForDemo1(e) {
  if (drag1) {
    rect1.w = (e.pageX - this.offsetLeft) - rect1.startX;
    rect1.h = (e.pageY - this.offsetTop) - rect1.startY;
   if(rect1.w <= 128 && rect1.h <= 128){
        drawBorderRectOnMyCanvas(rect1.w, rect1.h, inputCtx1, rect1, imageData1);
    }else{
      if(rect1.w >= 128 && rect1.h >= 128){
        drawBorderRectOnMyCanvas(128, 128, inputCtx1, rect1, imageData1);
      }else{
        if(rect1.w >= 128){
          drawBorderRectOnMyCanvas(128, rect1.h, inputCtx1, rect1, imageData1);
        }else{
          drawBorderRectOnMyCanvas(rect1.w, 128, inputCtx1, rect1, imageData1);
        }
      }
    }
  }
}

function mouseMoveForDemo2(e) {
  if (drag2) {
    rect2.w = (e.pageX - this.offsetLeft) - rect2.startX;
    rect2.h = (e.pageY - this.offsetTop) - rect2.startY;
   if(rect2.w <= 128 && rect2.h <= 128){
        drawBorderRectOnMyCanvas(rect2.w, rect2.h, inputCtx2, rect2, imageData2);
    }else{
      if(rect2.w >= 128 && rect2.h >= 128){
        drawBorderRectOnMyCanvas(128, 128, inputCtx2, rect2, imageData2);
      }else{
        if(rect2.w >= 128){
          drawBorderRectOnMyCanvas(128, rect2.h, inputCtx2, rect2, imageData2);
        }else{
          drawBorderRectOnMyCanvas(rect2.w, 128, inputCtx2, rect2, imageData2);
        }
      }
    }
  }
}

function mouseMoveForDemo4(e) {
  if (drag4) {
   rect4.w = (e.pageX - this.offsetLeft) - rect4.startX;
   rect4.h = (e.pageY - this.offsetTop) - rect4.startY;
   if(rect4.w <= 128 && rect4.h <= 128){
        drawBorderRectOnMyCanvas(rect4.w, rect4.h, inputCtx4, rect4, imageData4);
    }else{
      if(rect4.w >= 128 && rect4.h >= 128){
        drawBorderRectOnMyCanvas(128, 128, inputCtx4, rect4, imageData4);
      }else{
        if(rect4.w >= 128){
          drawBorderRectOnMyCanvas(128, rect4.h, inputCtx4, rect4, imageData4);
        }else{
          drawBorderRectOnMyCanvas(rect4.w, 128, inputCtx4, rect4, imageData4);
        }
      }
    }
  }
}

function mouseMoveForDemo5(e) {
  if (drag5) {
   rect5.w = (e.pageX - this.offsetLeft) - rect5.startX;
   rect5.h = (e.pageY - this.offsetTop) - rect5.startY;
   if(rect5.w <= 128 && rect5.h <= 128){
        drawBorderRectOnMyCanvas(rect5.w, rect5.h, inputCtx5, rect5, imageData5);
    }else{
      if(rect5.w >= 128 && rect5.h >= 128){
        drawBorderRectOnMyCanvas(128, 128, inputCtx5, rect5, imageData5);
      }else{
        if(rect5.w >= 128){
          drawBorderRectOnMyCanvas(128, rect5.h, inputCtx5, rect5, imageData5);
        }else{
          drawBorderRectOnMyCanvas(rect5.w, 128, inputCtx5, rect5, imageData5);
        }
      }
    }
  }
}

function drawBorderRectOnMyCanvas(width, height, context, rectangle, imgData) {
  context.putImageData(imgData,0,0);
  context.strokeStyle = "#FFFFFF";
  context.strokeRect(rectangle.startX+1, rectangle.startY+1, width-2, height-2);
}

function fillMaskRectOnMyCanvas(width, height, context, rectangle){
  context.fillStyle = "#FFFFFF";
  context.fillRect(rectangle.startX, rectangle.startY, width, height);
}

function fillMaskRectOnMyMaskCanvas(width, height, maskContext, rectangle){
  maskContext.fillStyle = "#FFFFFF";
  maskContext.fillRect(rectangle.startX, rectangle.startY, width, height);
}

init();
</script>
</body>
</html>
